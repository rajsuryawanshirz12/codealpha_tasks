<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile | CastCircle</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="dashboard-container">

        <aside class="left-sidebar">
            <div class="brand">
                <div class="logo-circle"><i class="fas fa-microphone-lines"></i></div>
                <span class="brand-name">CastCircle</span>
            </div>

            <div class="menu-item active" onclick="window.location.href='index.html'">
                <i class="fas fa-arrow-left"></i> <span>Back to Feed</span>
            </div>

            <div class="sidebar-section">
                <h3>LIBRARY</h3>
                <div class="menu-item"><i class="far fa-heart"></i> <span>Favorites</span></div>
                <div class="menu-item"><i class="far fa-clock"></i> <span>Listen Later</span></div>
            </div>
        </aside>

        <main class="center-feed">
            
            <div class="profile-card">
                <img src="https://i.pravatar.cc/150?img=11" id="profile-pic">
                <h2 id="profile-name">Loading...</h2>
                <p style="color: #888; font-size: 14px;">Podcast Creator â€¢ ðŸŽ§ Audio Enthusiast</p>
                
                <div class="profile-stats">
                    <div class="stat-box"><strong>12</strong><span>Podcasts</span></div>
                    <div class="stat-box"><strong>1.4k</strong><span>Followers</span></div>
                    <div class="stat-box"><strong>850</strong><span>Following</span></div>
                </div>
                
                <button class="btn-follow">Follow User</button>
            </div>

            <h3 style="margin-bottom: 15px; font-size: 18px;">Recent Episodes</h3>
            
            <div class="content-grid" id="user-feed">
                </div>
        </main>

        <aside class="right-sidebar">
            <div class="profile-header">
                <div class="user-profile">
                    <img src="https://i.pravatar.cc/150?img=11" id="my-avatar-small">
                    <span id="my-name-small">Me</span>
                </div>
            </div>
            
            <div class="chat-module">
                <div class="chat-header-area">
                    <h4>Community Chat ðŸ’¬</h4>
                    <p>Connect with this creator's fans.</p>
                </div>
                <div class="chat-messages">
                    <div class="pinned-msg">
                        <i class="fas fa-star" style="color: gold;"></i>
                        <p>Welcome to the fan club!</p>
                    </div>
                </div>
                <div class="chat-input-area">
                    <div class="input-wrapper">
                        <input type="text" placeholder="Say hello...">
                        <button class="send-btn"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </aside>

    </div>

    <script>
        const API_URL = 'http://localhost:5001/api';
        
        document.addEventListener('DOMContentLoaded', async () => {
            // 1. Get Logged In User Info (for top right corner)
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if(currentUser) {
                document.getElementById('my-name-small').innerText = currentUser.username;
                // Simple hash for avatar consistency
                document.getElementById('my-avatar-small').src = `https://i.pravatar.cc/150?img=${currentUser.username.length % 70}`;
            }

            // 2. Get Profile User Info from URL
            const params = new URLSearchParams(window.location.search);
            const username = params.get('username') || "Unknown User";
            
            // Set Profile Header
            document.getElementById('profile-name').innerText = username;
            document.getElementById('profile-pic').src = `https://i.pravatar.cc/150?img=${username.length % 70}`;

            // 3. Fetch & Filter Posts
            const res = await fetch(`${API_URL}/posts`);
            const allPosts = await res.json();
            const userPosts = allPosts.filter(p => p.username === username);

            const container = document.getElementById('user-feed');
            
            if(userPosts.length === 0) {
                container.innerHTML = "<div style='text-align:center; padding:40px; color:#999;'>No episodes uploaded yet.</div>";
            } else {
                userPosts.forEach(post => {
                    // Create Card using the SAME structure as the feed
                    const div = document.createElement('div');
                    div.className = 'event-card'; // Reusing the exact class from style.css
                    div.innerHTML = `
                        <div class="card-image">
                            <img src="${post.coverImage}" alt="Cover">
                        </div>
                        <div class="card-details">
                            <div class="category-tag">${post.category || 'Podcast'}</div>
                            <h3>${post.title}</h3>
                            <p class="description">${post.description}</p>
                            <div class="card-footer">
                                <button class="btn-play">
                                    <i class="fas fa-play"></i> Listen
                                </button>
                                <div class="actions">
                                    <span class="action-btn"><i class="far fa-heart"></i> ${post.likes || 0}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
        });
    </script>
</body>
</html>