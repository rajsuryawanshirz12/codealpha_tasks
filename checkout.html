<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Raj Suryawanshi">
  <link rel="shortcut icon" href="favicom2.png">
  <title>Checkout - DropZone India</title>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="css/tiny-slider.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">

  <style>
    /* Checkout Page Specific Styling */
    .form-control {
        height: 50px;
        border-radius: 12px;
        border: 1px solid #dee2e6;
        font-family: inherit;
        padding-left: 20px;
    }
    .form-control:focus {
        border-color: #3b5d50;
        box-shadow: none;
    }
    .form-group {
        margin-bottom: 25px;
    }
    
    /* THE FIX: height 100% forces the card to fill the column height */
    .checkout-card {
        border: 1px solid #dee2e6;
        border-radius: 20px;
        padding: 40px;
        height: 100%; /* Crucial for equal height */
        display: flex;
        flex-direction: column;
    }
    
    .card-white { background-color: #ffffff; }
    .card-gray  { background-color: #f8f9fa; }

    .btn-place-order {
        background-color: #3b5d50;
        color: white;
        font-weight: 700;
        padding: 18px 30px;
        border-radius: 20px;
        width: 100%;
        border: none;
        font-size: 18px;
        transition: 0.3s;
        margin-top: auto; /* Pushes button to bottom if needed */
    }
    .btn-place-order:hover {
        background-color: #2f4858;
        color: white;
        transform: translateY(-2px);
    }
    
    .payment-method-box {
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        background: white;
        cursor: pointer;
        transition: 0.2s;
    }
    .payment-method-box:hover {
        border-color: #3b5d50;
    }
    
    /* Table Styling */
    .site-block-order-table th {
        border-top: none;
        border-bottom: 2px solid #dee2e6;
        font-weight: 700;
        padding-bottom: 15px;
    }
    .site-block-order-table td {
        padding: 20px 0;
        border-bottom: 1px solid #eee;
        color: #555;
    }
  </style>
</head>

<body>

  <nav class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="index.html">DropZone<span>.</span></a>
      <div class="collapse navbar-collapse" id="navbarsFurni">
        <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
          <li><a class="nav-link" href="index.html">Home</a></li>
          <li><a class="nav-link" href="all-kicks.html">All Kicks</a></li>
          <li><a class="nav-link" href="about.html">New Drops</a></li>
          <li><a class="nav-link" href="brands.html">Brands</a></li>
          <li><a class="nav-link" href="ourstory.html">Our Story</a></li>
          <li><a class="nav-link" href="contact.html">Support</a></li>
        </ul>
        <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
            <li style="margin-right: 20px;">
                        <a class="nav-link" href="wishlist.html">
                            <i class="fa-regular fa-heart" style="font-size: 22px; color:white; vertical-align: middle; margin-bottom: 2px;"></i>
                        </a>
                    </li>
            <li style="margin-right: 20px;"><a class="nav-link" href="#"><img src="images/user.svg"></a></li>
            <li><a class="nav-link" href="cart.html"><img src="images/cart.svg"></a></li>
        </ul>
      </div>
    </div>
  </nav>
 <div class="untree_co-section">
    <div class="container">
      
      <div class="row d-flex align-items-stretch">
        
        <div class="col-md-6 mb-5 mb-md-0 d-flex flex-column">
          <h2 class="h3 mb-3 text-black font-weight-bold">Billing Details</h2>
          
          <div class="checkout-card card-white flex-grow-1">
            <div class="form-group row">
              <div class="col-md-6">
                <label for="c_fname" class="text-black mb-2">First Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="c_fname" name="c_fname">
              </div>
              <div class="col-md-6">
                <label for="c_lname" class="text-black mb-2">Last Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="c_lname" name="c_lname">
              </div>
            </div>

            <div class="form-group row">
              <div class="col-md-12">
                <label for="c_address" class="text-black mb-2">Street Address <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="c_address" name="c_address" placeholder="House number and street name">
              </div>
            </div>

            <div class="form-group row">
              <div class="col-md-6">
                <label for="c_state_country" class="text-black mb-2">State / Country <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="c_state_country" name="c_state_country">
              </div>
              <div class="col-md-6">
                <label for="c_postal_zip" class="text-black mb-2">Pincode / Zip <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="c_postal_zip" name="c_postal_zip">
              </div>
            </div>

            <div class="form-group row mb-5">
              <div class="col-md-6">
                <label for="c_email_address" class="text-black mb-2">Email Address <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="c_email_address" name="c_email_address">
              </div>
              <div class="col-md-6">
                <label for="c_phone" class="text-black mb-2">Phone <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="c_phone" name="c_phone" placeholder="Phone Number">
              </div>
            </div>

            <div class="form-group mb-0">
              <label for="c_order_notes" class="text-black mb-2">Order Notes</label>
              <textarea name="c_order_notes" id="c_order_notes" cols="30" rows="5" class="form-control" placeholder="Write any special instructions here..." style="height: 100%;"></textarea>
            </div>
          </div>
        </div>

        <div class="col-md-6 d-flex flex-column">
          <div class="row mb-5 h-100">
            <div class="col-md-12 h-100">
              <h2 class="h3 mb-3 text-black font-weight-bold">Your Order</h2>
              
              <div class="checkout-card card-gray flex-grow-1">
                
                <table class="table site-block-order-table mb-5">
                  <thead>
                    <th>Product</th>
                    <th>Total</th>
                  </thead>
                  <tbody id="checkout-items">
                    <tr><td colspan="2">Loading Cart...</td></tr>
                  </tbody>
                  <tfoot>
                    <tr>
                        <td class="text-black font-weight-bold" style="font-size: 1.2rem; padding-top: 20px;">Order Total</td>
                        <td class="text-black font-weight-bold" style="color: #3b5d50; font-size: 1.5rem; padding-top: 20px;">
                            <strong id="checkout-total">â‚¹0</strong>
                        </td>
                    </tr>
                  </tfoot>
                </table>

                <div class="mb-4">
                    <h5 class="text-black mb-3">Payment Method</h5>
                    
                    <div class="payment-method-box">
                        <label class="d-flex align-items-center mb-0" style="cursor: pointer;">
                            <input type="radio" name="payment" checked class="me-3" style="width: 18px; height: 18px;"> 
                            <div>
                                <strong class="d-block text-black">UPI / QR Code</strong>
                                <span class="small text-muted">GooglePay, PhonePe, Paytm</span>
                            </div>
                        </label>
                    </div>

                    <div class="payment-method-box">
                        <label class="d-flex align-items-center mb-0" style="cursor: pointer;">
                            <input type="radio" name="payment" class="me-3" style="width: 18px; height: 18px;"> 
                            <div>
                                <strong class="d-block text-black">Credit / Debit Card</strong>
                                <span class="small text-muted">Visa, Mastercard, RuPay</span>
                            </div>
                        </label>
                    </div>

                    <div class="payment-method-box">
                        <label class="d-flex align-items-center mb-0" style="cursor: pointer;">
                            <input type="radio" name="payment" class="me-3" style="width: 18px; height: 18px;"> 
                            <div>
                                <strong class="d-block text-black">Cash on Delivery (COD)</strong>
                                <span class="small text-muted">Pay securely at your doorstep</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-group mt-auto">
<button class="btn btn-black btn-lg py-3 btn-block" type="button" onclick="placeOrder()">Place Order</button>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

   <footer class="footer-section">
        <div class="container relative">

            <div class="row">
                <div class="col-lg-8">
                    <div class="subscription-form">
                        <h3 class="d-flex align-items-center"><span class="me-1"><img src="images/envelope-outline.svg" alt="Image" class="img-fluid"></span><span>Join the Drop List</span></h3>

                        <form action="#" class="row g-3">
                            <div class="col-auto">
                                <input type="text" class="form-control" placeholder="Enter your name">
                            </div>
                            <div class="col-auto">
                                <input type="email" class="form-control" placeholder="Enter your email">
                            </div>
                            <div class="col-auto">
                                <button class="btn btn-primary">
                                    <span class="fa fa-paper-plane"></span>
                                </button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>

            <div class="row g-5 mb-5">
                <div class="col-lg-4">
                    <div class="mb-4 footer-logo-wrap"><a href="index.html" class="footer-logo">DropZone<span>.</span></a></div>
                    <p class="mb-4">Your primary source for verified authentic kicks. From limited-edition retros to the latest performance drops, we check the drip so you don't have to.</p>

                    <ul class="list-unstyled custom-social">
                        <li><a href="#"><span class="fa fa-brands fa-facebook-f"></span></a></li>
                        <li><a href="#"><span class="fa fa-brands fa-twitter"></span></a></li>
                        <li><a href="#"><span class="fa fa-brands fa-instagram"></span></a></li>
                        <li><a href="#"><span class="fa fa-brands fa-linkedin"></span></a></li>
                    </ul>
                </div>

                <div class="col-lg-8">
                    <div class="row links-wrap">
                        <div class="col-6 col-sm-6 col-md-3">
                            <ul class="list-unstyled">
                                <li><a href="ourstory.html">About us</a></li>
                                <li><a href="authenticity.html">Authenticity Check</a></li>
                                <li><a href="blog.html">Blog Drops</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                            </ul>
                        </div>

                        <div class="col-6 col-sm-6 col-md-3">
                            <ul class="list-unstyled">
                                <li><a href="contact.html">Support</a></li>
                                <li><a href="knowledge.html">Knowledge base</a></li>
                                <li><a href="https://wa.me/919876543210" target="_blank">Live chat</a></li>
                            </ul>
                        </div>

                        <div class="col-6 col-sm-6 col-md-3">
                            <ul class="list-unstyled">
                                <li><a href="jobs.html">Jobs</a></li>
                                <li><a href="team.html">Our team</a></li>
                                <li><a href="team.html">Leadership</a></li>
                                <li><a href="privacy.html">Privacy Policy</a></li>
                            </ul>
                        </div>

                        <div class="col-6 col-sm-6 col-md-3">
                            <ul class="list-unstyled">
                                <li><a href="all-kicks.html?brand=nike">Nike</a></li>
                                <li><a href="all-kicks.html?brand=adidas">Adidas</a></li>
                                <li><a href="all-kicks.html?brand=newbalance">New Balance</a></li>
                                <li><a href="all-kicks.html?brand=converse">Converse</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>

            <div class="border-top copyright">
                <div class="row pt-4">
                    <div class="col-lg-6">
                        <p class="mb-2 text-center text-lg-start">Copyright &copy;<script>document.write(new Date().getFullYear());</script>. All Rights Reserved. &mdash; Designed with love by <a href="https://rostech.in">Raj Suryawanshi</a> Distributed By <a href="https://rostech.com">RosTech</a>  
        </p>
                    </div>

                    <div class="col-lg-6 text-center text-lg-end">
                        <ul class="list-unstyled d-inline-flex ms-auto">
                            <li class="me-4"><a href="terms.html">Terms &amp; Conditions</a></li>
                            <li><a href="privacy.html">Privacy Policy</a></li>
                        </ul>
                    </div>

                </div>
            </div>

        </div>
    </footer>

  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/tiny-slider.js"></script>
  <script src="js/custom.js"></script>

  <script>
    // 1. Load Data on Page Load
    document.addEventListener('DOMContentLoaded', () => {
        const cart = JSON.parse(localStorage.getItem('dropzoneCart')) || [];
        const tbody = document.getElementById('checkout-items');
        const totalEl = document.getElementById('checkout-total');
        
        tbody.innerHTML = ''; 
        let grandTotal = 0;

        if(cart.length === 0) {
            tbody.innerHTML = '<tr><td colspan="2">Your cart is empty.</td></tr>';
        } else {
            cart.forEach(item => {
                let itemTotal = item.price * item.qty;
                grandTotal += itemTotal;
                
                let row = `
                    <tr>
                      <td>${item.title} <strong class="mx-2">x</strong> ${item.qty}</td>
                      <td>â‚¹${itemTotal.toLocaleString('en-IN')}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        totalEl.innerText = 'â‚¹' + grandTotal.toLocaleString('en-IN');
    });

    // 2. Place Order Function
    function placeOrder() {
        const name = document.getElementById('c_fname').value;
        const address = document.getElementById('c_address').value;
        
        if(name && address) {
            localStorage.removeItem('dropzoneCart'); 
            alert("Order Confirmed! \n\nThank you " + name + ". Your order tracking ID is DZ-" + Math.floor(Math.random() * 10000));
            window.location.href = "index.html"; 
        } else {
            alert("Please fill in your Name and Address to complete the order.");
        }
    }
  </script>
  <script src="js/cart.js"></script>
<script src="js/wishlist.js"></script>
<script src="js/user.js"></script> ```

<script>

    // 1. CHECK IF USER IS LOGGED IN
    const user = JSON.parse(localStorage.getItem('user'));
    
    // Auto-fill form if logged in
    if (user) {
        // Try to find the input fields by their IDs (Make sure these IDs match your HTML)
        const emailField = document.getElementById('c_email_address');
        const fnameField = document.getElementById('c_fname');
        
        if(emailField) emailField.value = user.email;
        if(fnameField) fnameField.value = user.name.split(" ")[0];
    }

    // 2. RENDER ORDER SUMMARY (Optional - Visual only)
    document.addEventListener('DOMContentLoaded', () => {
        const cart = JSON.parse(localStorage.getItem('dropzoneCart')) || [];
        const tbody = document.getElementById('checkout-items'); 
        const totalEl = document.getElementById('order-total'); // Ensure you have this ID on the total price <strong>

        if (tbody && cart.length > 0) {
            tbody.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                let itemTotal = item.price * item.qty;
                total += itemTotal;

                tbody.innerHTML += `
                    <tr>
                        <td>${item.title} <strong class="mx-2">x</strong> ${item.qty}</td>
                        <td>â‚¹${itemTotal.toLocaleString('en-IN')}</td>
                    </tr>
                `;
            });

            if(totalEl) totalEl.innerText = "â‚¹" + total.toLocaleString('en-IN');
        }
    });

    // 3. THE BACKEND CONNECTION
    async function placeOrder() {
        const cart = JSON.parse(localStorage.getItem('dropzoneCart')) || [];
        
        if (cart.length === 0) {
            alert("Your cart is empty!");
            return;
        }

        // 1. Validation
        const address = document.getElementById('c_address').value;
        if (!address) {
            alert("Please fill in your address.");
            return;
        }

        if (!user) {
            alert("Please log in to place an order.");
            window.location.href = "login.html";
            return;
        }

        // 2. Prepare Data
        const orderData = {
            user_email: user.email,
            items: cart.map(item => ({
                product_name: item.title,
                quantity: item.qty,
                price: "â‚¹" + item.price // Convert number back to string for DB consistency
            })),
            total_amount: "â‚¹" + cart.reduce((sum, item) => sum + (item.price * item.qty), 0),
            shipping_address: {
                address: address,
                city: document.getElementById('c_state_country').value || "India", // Fallback if ID differs
                zip: document.getElementById('c_postal_zip').value || "000000"
            }
        };

        // 3. Send to MongoDB
        try {
            const response = await fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(orderData)
            });

            if (response.ok) {
                const data = await response.json();
                alert("Order Placed Successfully! ðŸŽ‰\nOrder ID: " + data.orderId);
                
                // Clear Cart
                localStorage.removeItem('dropzoneCart');
                window.location.href = "thankyou.html";
            } else {
                alert("Failed to place order. Server Error.");
            }
        } catch (err) {
            console.error(err);
            alert("Connection Error. Is the server running?");
        }
    }
</script>
</body>
</html>
